var Molvwr;!function(e){var n=function(){function e(e){var n=this;this.canvas=e,this.engine=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0}),this.engine.runRenderLoop(function(){n.scene&&n.scene.render()}),this.bindedResize=this.resize.bind(this),window.addEventListener("resize",this.bindedResize)}return e.prototype.resize=function(){this.engine.resize()},e.prototype.exportScreenshot=function(){return this.canvas.toDataURL("image/png")},e.prototype.dispose=function(){this.engine.dispose(),window.removeEventListener("resize",this.bindedResize)},e.prototype.sphereMaterial=function(e,n,o){this.viewmode&&this.viewmode.sphereMaterial(this,e,n,o)},e.prototype.cylinderMaterial=function(e,n,o){this.viewmode&&this.viewmode.cylinderMaterial(this,e,n,o)},e.prototype.createScene=function(){this.scene&&this.scene.dispose(),console.log("create babylon scene");var e=new BABYLON.Scene(this.engine);this.scene=e,this.viewmode&&this.viewmode.createScene(this)},e}();e.BabylonContext=n}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(e){function n(){return{allowLOD:!0,renderers:["BondsCylinder","Sphere"],atomScaleFactor:1,cylinderScale:.5,sphereSegments:16,cylinderSegments:8}}function o(){return{allowLOD:!0,renderers:["Sphere"],atomScaleFactor:3,cylinderScale:.6,sphereSegments:16,sphereLOD:[{depth:0,segments:32,effects:!0},{depth:5,segments:24,effects:!0},{depth:10,segments:16,effects:!0},{depth:20,segments:12,effects:!0},{depth:40,segments:6,effects:!0},{depth:60,segments:6},{depth:80,segments:4}]}}function r(){return{allowLOD:!0,renderers:["Sticks"],atomScaleFactor:1.3,cylinderScale:1.4,sphereSegments:16,cylinderSegments:16,cylinderLOD:[{depth:0,segments:64,effects:!0},{depth:10,segments:32,effects:!0},{depth:20,segments:24,effects:!0},{depth:40,segments:16,effects:!0},{depth:60,segments:12},{depth:80,segments:8}]}}function t(){return{allowLOD:!0,renderers:["BondsCylinder","Sphere"],atomScaleFactor:1.3,cylinderScale:.6,sphereSegments:16,cylinderSegments:8,cylinderLOD:[{depth:0,segments:64,effects:!0},{depth:5,segments:32,effects:!0},{depth:20,segments:24,effects:!0},{depth:60,segments:12}],sphereLOD:[{depth:0,segments:64,effects:!0},{depth:5,segments:32,effects:!0},{depth:10,segments:24,effects:!0},{depth:20,segments:16,effects:!0},{depth:40,segments:12,effects:!0},{depth:60,segments:6},{depth:80,segments:4}]}}e.defaultConfig=n,e.spheres=o,e.sticks=r,e.ballsAndSticks=t}(e.Config||(e.Config={}))}(Molvwr||(Molvwr={}));var __global=this,Molvwr;!function(e){function n(){if(!__global.BABYLON)return void console.error("Babylon.js is not available, please add a reference to Babylon.js script");var n;n=arguments[0]?arguments[0].length?arguments[0]:[arguments[0]]:document.querySelectorAll("*[data-molvwr]");for(var r=0,t=n.length;r<t;r++){var s=n[r];if(s&&s.style){s.molvwr&&s.molvwr.dispose();var i=s.getAttribute("data-molvwr"),a=(s.getAttribute("data-molvwr-content"),s.getAttribute("data-molvwr-format")),l=s.getAttribute("data-molvwr-view");if(a||(a=o.getMoleculeFileFormat(i)),!i)return void console.error("please specify a molecule url by adding a data-molvwr attribute");if(!a)return void console.error("molecule file format not found or not specified for "+i);var m=null;if("spheres"==l?m=e.Config.spheres():"ballsandsticks"==l?m=e.Config.ballsAndSticks():"sticks"==l&&(m=e.Config.sticks()),i&&a){new o(s,m).loadContentFromUrl(i,a)}}}}e.process=n;var o=function(){function n(n,o,r){if(!__global.BABYLON)throw new Error("Babylon.js is not available, please add a reference to Babylon.js script");if(!n)throw new Error("you must provide an element to host the viewer");this.config=o||e.Config.defaultConfig(),this.element=n,this.element.molvwr=this,this.canvas=document.createElement("CANVAS"),this.canvas.setAttribute("touch-action","manipulation"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.element.appendChild(this.canvas),this.context=new e.BabylonContext(this.canvas),this.viewmode=r,this.viewmode||(this.viewmode=new e.ViewModes.Standard)}return n.prototype.dispose=function(){this.context.dispose(),this.context=null,this.element=null,this.canvas=null,this.element.innerHTML=""},n.prototype._loadContentFromString=function(n,o,r){var t=this;return new e.Utils.Promise(function(s,i){var a=e.Parser[o];if(a){console.time("parsing "+o);var l=a.parse(n);console.timeEnd("parsing "+o),l?t._postProcessMolecule(l).then(function(){return r&&r(l),t._renderMolecule(l)}).then(function(){return l}).then(s,i):(console.warn("no molecule from parser "+o),s())}else console.warn("no parser for "+o),s()})},n.prototype._renderMolecule=function(n){var o=this;return this.molecule=n,this._createContext(),new e.Utils.Promise(function(r,t){if(console.time("rendering..."),o.config.renderers){var s=(o.config.renderers.length,[]);o.config.renderers.forEach(function(n){var r=e.Renderer[n];if(r){var t=new r(o,o.context,o.config);s.push(t.render(o.molecule))}}),e.Utils.Promise.all(s).then(function(){console.timeEnd("rendering...")}).then(r,t)}else r(n)})},n.prototype.setOptions=function(e,n){this.config=e,this.refresh(n)},n.prototype.setViewMode=function(n,o){this.viewmode=n,this.viewmode||(this.viewmode=new e.ViewModes.Standard),this.refresh(o)},n.prototype.refresh=function(e){this.molecule?this._renderMolecule(this.molecule).then(e,e):e&&e()},n.prototype._createContext=function(){this.context&&this.context.dispose(),this.context=new e.BabylonContext(this.canvas),this.context.viewmode=this.viewmode,this.context.createScene()},n.prototype.exportScreenshot=function(){return this.context.exportScreenshot()},n.endsWith=function(e,n){return-1!==e.indexOf(n,e.length-n.length)},n.getMoleculeFileFormat=function(e){return n.endsWith(e,".pdb")?"pdb":n.endsWith(e,".mol")||n.endsWith(e,".sdf")?"mol":n.endsWith(e,".xyz")?"xyz":null},n.prototype.loadContentFromString=function(e,n,o,r){this._createContext(),this._loadContentFromString(e,n,o).then(r,r)},n.prototype.loadContentFromUrl=function(e,o,r,t){var s=this;o||(o=n.getMoleculeFileFormat(e)),o||console.error("molecule file format not found or not specified"),this._createContext();try{var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&(200==i.status?s._loadContentFromString(i.responseText,o,r).then(t,t):(console.warn("cannot get content from "+e+" "+i.status+" "+i.statusText),t()))},i.open("GET",e,!0),i.send(null)}catch(e){console.error(e),t()}},n.prototype._postProcessMolecule=function(e){var n=this;return console.time("post process"),e.kinds=e.kinds||{},e.bondkinds=e.bondkinds||{},e.batchSize=Math.min(120,e.atoms.length/4>>0),e.batchSize=Math.max(40,e.batchSize),this._center(e).then(function(){return n._calculateAtomsBondsAsync(e)}).then(function(){console.timeEnd("post process")})},n.prototype._calculateAtomsBondsAsync=function(n){console.time("check bounds");var o=[],r=n.atoms.length;return e.Utils.runBatch(0,300,n.atoms,function(e,t,s){n.kinds[e.kind.symbol]?n.kinds[e.kind.symbol].count++:n.kinds[e.kind.symbol]={kind:e.kind,count:1};for(var i=s+1;i<r;i++){var a=n.atoms[i],l=new BABYLON.Vector3(e.x,e.y,e.z),m=new BABYLON.Vector3(a.x,a.y,a.z),c=BABYLON.Vector3.Distance(l,m);c<1.3*(e.kind.radius+a.kind.radius)&&(n.bondkinds[e.kind.symbol+"#"+a.kind.symbol]?n.bondkinds[e.kind.symbol+"#"+a.kind.symbol].count++:n.bondkinds[e.kind.symbol+"#"+a.kind.symbol]={d:c,key:e.kind.symbol+"#"+a.kind.symbol,kindA:e.kind,kindB:a.kind,count:1},o.push({d:c,atomA:e,atomB:a,cutoff:c/(e.kind.radius+a.kind.radius)}))}},"checkbounds").then(function(){n.bonds=o,console.timeEnd("check bounds"),console.log("found "+o.length+" bonds")})},n.prototype._getCentroid=function(e){var n=1/0,o=-1/0,r=1/0,t=-1/0,s=1/0,i=-1/0;return e.atoms.forEach(function(e){e.x>o&&(o=e.x),e.x<n&&(n=e.x),e.y>t&&(t=e.y),e.y<r&&(r=e.y),e.z>i&&(i=e.z),e.z<s&&(s=e.z)}),{x:(n+o)/2,y:(r+t)/2,z:(s+i)/2}},n.prototype._center=function(n){console.time("recenter atoms");var o=this._getCentroid(n);return n.atoms.forEach(function(e){e.x-=o.x,e.y-=o.y,e.z-=o.z}),console.timeEnd("recenter atoms"),e.Utils.Promise.resolve()},n}();e.Viewer=o}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(e){e.elements=[{symbol:"Xx",name:"unknown",mass:1,radius:1,color:[1,.078,.576],number:0},{symbol:"H",name:"hydrogen",mass:1.00794,radius:.31,color:[1,1,1],number:1},{symbol:"He",name:"helium",mass:4.002602,radius:.28,color:[.851,1,1],number:2},{symbol:"Li",name:"lithium",mass:6.941,radius:1.28,color:[.8,.502,1],number:3},{symbol:"Be",name:"beryllium",mass:9.012182,radius:.96,color:[.761,1,0],number:4},{symbol:"B",name:"boron",mass:10.811,radius:.84,color:[1,.71,.71],number:5},{symbol:"C",name:"carbon",mass:12.0107,radius:.73,color:[.565,.565,.565],number:6},{symbol:"N",name:"nitrogen",mass:14.0067,radius:.71,color:[.188,.314,.973],number:7},{symbol:"O",name:"oxygen",mass:15.9994,radius:.66,color:[1,.051,.051],number:8},{symbol:"F",name:"fluorine",mass:18.9984032,radius:.57,color:[.565,.878,.314],number:9},{symbol:"Ne",name:"neon",mass:20.1797,radius:.58,color:[.702,.89,.961],number:10},{symbol:"Na",name:"sodium",mass:22.98976928,radius:1.66,color:[.671,.361,.949],number:11},{symbol:"Mg",name:"magnesium",mass:24.305,radius:1.41,color:[.541,1,0],number:12},{symbol:"Al",name:"aluminum",mass:26.9815386,radius:1.21,color:[.749,.651,.651],number:13},{symbol:"Si",name:"silicon",mass:28.0855,radius:1.11,color:[.941,.784,.627],number:14},{symbol:"P",name:"phosphorus",mass:30.973762,radius:1.07,color:[1,.502,0],number:15},{symbol:"S",name:"sulfur",mass:32.065,radius:1.05,color:[1,1,.188],number:16},{symbol:"Cl",name:"chlorine",mass:35.453,radius:1.02,color:[.122,.941,.122],number:17},{symbol:"Ar",name:"argon",mass:39.948,radius:1.06,color:[.502,.82,.89],number:18},{symbol:"K",name:"potassium",mass:39.0983,radius:2.03,color:[.561,.251,.831],number:19},{symbol:"Ca",name:"calcium",mass:40.078,radius:1.76,color:[.239,1,0],number:20},{symbol:"Sc",name:"scandium",mass:44.955912,radius:1.7,color:[.902,.902,.902],number:21},{symbol:"Ti",name:"titanium",mass:47.867,radius:1.6,color:[.749,.761,.78],number:22},{symbol:"V",name:"vanadium",mass:50.9415,radius:1.53,color:[.651,.651,.671],number:23},{symbol:"Cr",name:"chromium",mass:51.9961,radius:1.39,color:[.541,.6,.78],number:24},{symbol:"Mn",name:"manganese",mass:54.938045,radius:1.39,color:[.611,.478,.78],number:25},{symbol:"Fe",name:"iron",mass:55.845,radius:1.32,color:[.878,.4,.2],number:26},{symbol:"Co",name:"cobalt",mass:58.6934,radius:1.26,color:[.941,.565,.627],number:27},{symbol:"Ni",name:"nickel",mass:58.933195,radius:1.24,color:[.314,.816,.314],number:28},{symbol:"Cu",name:"copper",mass:63.546,radius:1.32,color:[.784,.502,.2],number:29},{symbol:"Zn",name:"zinc",mass:65.38,radius:1.22,color:[.49,.502,.69],number:30},{symbol:"Ga",name:"gallium",mass:69.723,radius:1.22,color:[.761,.561,.561],number:31},{symbol:"Ge",name:"germanium",mass:72.64,radius:1.2,color:[.4,.561,.561],number:32},{symbol:"As",name:"arsenic",mass:74.9216,radius:1.19,color:[.741,.502,.89],number:33},{symbol:"Se",name:"selenium",mass:78.96,radius:1.2,color:[1,.631,0],number:34},{symbol:"Br",name:"bromine",mass:79.904,radius:1.2,color:[.651,.161,.161],number:35},{symbol:"Kr",name:"krypton",mass:83.798,radius:1.16,color:[.361,.722,.82],number:36},{symbol:"Rb",name:"rubidium",mass:85.4678,radius:2.2,color:[.439,.18,.69],number:37},{symbol:"Sr",name:"strontium",mass:87.62,radius:1.95,color:[0,1,0],number:38},{symbol:"Y",name:"yttrium",mass:88.90585,radius:1.9,color:[.58,1,1],number:39},{symbol:"Zr",name:"zirconium",mass:91.224,radius:1.75,color:[.58,.878,.878],number:40},{symbol:"Nb",name:"niobium",mass:92.90638,radius:1.64,color:[.451,.761,.788],number:41},{symbol:"Mo",name:"molybdenum",mass:95.96,radius:1.54,color:[.329,.71,.71],number:42},{symbol:"Tc",name:"technetium",mass:98,radius:1.47,color:[.231,.62,.62],number:43},{symbol:"Ru",name:"ruthenium",mass:101.07,radius:1.46,color:[.141,.561,.561],number:44},{symbol:"Rh",name:"rhodium",mass:102.9055,radius:1.42,color:[.039,.49,.549],number:45},{symbol:"Pd",name:"palladium",mass:106.42,radius:1.39,color:[0,.412,.522],number:46},{symbol:"Ag",name:"silver",mass:107.8682,radius:1.45,color:[.753,.753,.753],number:47},{symbol:"Cd",name:"cadmium",mass:112.411,radius:1.44,color:[1,.851,.561],number:48},{symbol:"In",name:"indium",mass:114.818,radius:1.42,color:[.651,.459,.451],number:49},{symbol:"Sn",name:"tin",mass:118.71,radius:1.39,color:[.4,.502,.502],number:50},{symbol:"Sb",name:"antimony",mass:121.76,radius:1.39,color:[.62,.388,.71],number:51},{symbol:"Te",name:"tellurium",mass:127.6,radius:1.38,color:[.831,.478,0],number:52},{symbol:"I",name:"iodine",mass:126.9047,radius:1.39,color:[.58,0,.58],number:53},{symbol:"Xe",name:"xenon",mass:131.293,radius:1.4,color:[.259,.62,.69],number:54},{symbol:"Cs",name:"cesium",mass:132.9054519,radius:2.44,color:[.341,.09,.561],number:55},{symbol:"Ba",name:"barium",mass:137.327,radius:2.15,color:[0,.788,0],number:56},{symbol:"La",name:"lanthanum",mass:138.90547,radius:2.07,color:[.439,.831,1],number:57},{symbol:"Ce",name:"cerium",mass:140.116,radius:2.04,color:[1,1,.78],number:58},{symbol:"Pr",name:"praseodymium",mass:140.90765,radius:2.03,color:[.851,1,.78],number:59},{symbol:"Nd",name:"neodymium",mass:144.242,radius:2.01,color:[.78,1,.78],number:60},{symbol:"Pm",name:"promethium",mass:145,radius:1.99,color:[.639,1,.78],number:61},{symbol:"Sm",name:"samarium",mass:150.36,radius:1.98,color:[.561,1,.78],number:62},{symbol:"Eu",name:"europium",mass:151.964,radius:1.98,color:[.38,1,.78],number:63},{symbol:"Gd",name:"gadolinium",mass:157.25,radius:1.96,color:[.271,1,.78],number:64},{symbol:"Tb",name:"terbium",mass:158.92535,radius:1.94,color:[.189,1,.78],number:65},{symbol:"Dy",name:"dysprosium",mass:162.5,radius:1.92,color:[.122,1,.78],number:66},{symbol:"Ho",name:"holmium",mass:164.93032,radius:1.92,color:[0,1,.612],number:67},{symbol:"Er",name:"erbium",mass:167.259,radius:1.89,color:[0,.902,.459],number:68},{symbol:"Tm",name:"thulium",mass:168.93421,radius:1.9,color:[0,.831,.322],number:69},{symbol:"Yb",name:"ytterbium",mass:173.054,radius:1.87,color:[0,.749,.22],number:70},{symbol:"Lu",name:"lutetium",mass:174.9668,radius:1.87,color:[0,.671,.141],number:71},{symbol:"Hf",name:"hafnium",mass:178.49,radius:1.75,color:[.302,.761,1],number:72},{symbol:"Ta",name:"tantalum",mass:180.94788,radius:1.7,color:[.302,.651,1],number:73},{symbol:"W",name:"tungsten",mass:183.84,radius:1.62,color:[.129,.58,.839],number:74},{symbol:"Re",name:"rhenium",mass:186.207,radius:1.51,color:[.149,.49,.671],number:75},{symbol:"Os",name:"osmium",mass:190.23,radius:1.44,color:[.149,.4,.588],number:76},{symbol:"Ir",name:"iridium",mass:192.217,radius:1.41,color:[.09,.329,.529],number:77},{symbol:"Pt",name:"platinum",mass:195.084,radius:1.36,color:[.816,.816,.878],number:78},{symbol:"Au",name:"gold",mass:196.966569,radius:1.36,color:[1,.82,.137],number:79},{symbol:"Hg",name:"mercury",mass:200.59,radius:1.32,color:[.722,.722,.816],number:80},{symbol:"Tl",name:"thallium",mass:204.3833,radius:1.45,color:[.651,.329,.302],number:81},{symbol:"Pb",name:"lead",mass:207.2,radius:1.46,color:[.341,.349,.38],number:82},{symbol:"Bi",name:"bismuth",mass:208.9804,radius:1.48,color:[.62,.31,.71],number:83},{symbol:"Po",name:"polonium",mass:210,radius:1.4,color:[.671,.361,0],number:84},{symbol:"At",name:"astatine",mass:210,radius:1.5,color:[.459,.31,.271],number:85},{symbol:"Rn",name:"radon",mass:220,radius:1.5,color:[.259,.51,.588],number:86},{symbol:"Fr",name:"francium",mass:223,radius:2.6,color:[.259,0,.4],number:87},{symbol:"Ra",name:"radium",mass:226,radius:2.21,color:[0,.49,0],number:88},{symbol:"Ac",name:"actinium",mass:227,radius:2.15,color:[.439,.671,.98],number:89},{symbol:"Th",name:"thorium",mass:231.03588,radius:2.06,color:[0,.729,1],number:90},{symbol:"Pa",name:"protactinium",mass:232.03806,radius:2,color:[0,.631,1],number:91},{symbol:"U",name:"uranium",mass:237,radius:1.96,color:[0,.561,1],number:92},{symbol:"Np",name:"neptunium",mass:238.02891,radius:1.9,color:[0,.502,1],number:93},{symbol:"Pu",name:"plutonium",mass:243,radius:1.87,color:[0,.42,1],number:94},{symbol:"Am",name:"americium",mass:244,radius:1.8,color:[.329,.361,.949],number:95},{symbol:"Cm",name:"curium",mass:247,radius:1.69,color:[.471,.361,.89],number:96},{symbol:"Bk",name:"berkelium",mass:247,radius:1.66,color:[.541,.31,.89],number:97},{symbol:"Cf",name:"californium",mass:251,radius:1.68,color:[.631,.212,.831],number:98},{symbol:"Es",name:"einsteinium",mass:252,radius:1.65,color:[.702,.122,.831],number:99},{symbol:"Fm",name:"fermium",mass:257,radius:1.67,color:[.702,.122,.729],number:100},{symbol:"Md",name:"mendelevium",mass:258,radius:1.73,color:[.702,.051,.651],number:101},{symbol:"No",name:"nobelium",mass:259,radius:1.76,color:[.741,.051,.529],number:102},{symbol:"Lr",name:"lawrencium",mass:262,radius:1.61,color:[.78,0,.4],number:103},{symbol:"Rf",name:"rutherfordium",mass:261,radius:1.57,color:[.8,0,.349],number:104},{symbol:"Db",name:"dubnium",mass:262,radius:1.49,color:[.82,0,.31],number:105},{symbol:"Sg",name:"seaborgium",mass:266,radius:1.43,color:[.851,0,.271],number:106},{symbol:"Bh",name:"bohrium",mass:264,radius:1.41,color:[.878,0,.22],number:107},{symbol:"Hs",name:"hassium",mass:277,radius:1.34,color:[.902,0,.18],number:108},{symbol:"Mt",name:"meitnerium",mass:268,radius:1.29,color:[.922,0,.149],number:10},{symbol:"Ds",name:"Ds",mass:271,radius:1.28,color:[.922,0,.149],number:110},{symbol:"Uuu",name:"Uuu",mass:272,radius:1.21,color:[.922,0,.149],number:11},{symbol:"Uub",name:"Uub",mass:285,radius:1.22,color:[.922,0,.149],number:112},{symbol:"Uut",name:"Uut",mass:284,radius:1.36,color:[.922,0,.149],number:113},{symbol:"Uuq",name:"Uuq",mass:289,radius:1.43,color:[.922,0,.149],number:114},{symbol:"Uup",name:"Uup",mass:288,radius:1.62,color:[.922,0,.149],number:115},{symbol:"Uuh",name:"Uuh",mass:292,radius:1.75,color:[.922,0,.149],number:116},{symbol:"Uus",name:"Uus",mass:294,radius:1.65,color:[.922,0,.149],number:117},{symbol:"Uuo",name:"Uuo",mass:296,radius:1.57,color:[.922,0,.149],number:118}],e.elementsBySymbol={},e.elements.forEach(function(n){e.elementsBySymbol[n.symbol.toUpperCase()]=n}),e.elementsByNumber={},e.elements.forEach(function(n){e.elementsByNumber[n.number]=n}),e.MIN_ATOM_RADIUS=1/0,e.MAX_ATOM_RADIUS=-1/0,e.elements.forEach(function(n){e.MIN_ATOM_RADIUS=Math.min(e.MIN_ATOM_RADIUS,n.radius),e.MAX_ATOM_RADIUS=Math.max(e.MAX_ATOM_RADIUS,n.radius)})}(e.Elements||(e.Elements={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){function o(e){return e?parseFloat(e.trim()):0}n.mol={parse:function(n){console.log("parsing mol content");var r={atoms:[],title:null},t=n.split("\n");r.title=t[1];for(var s=0,i=t.length;s<i;s++)if(0==t[s].indexOf("  ")){var a=t[s].split(" ").filter(function(e){var n=e.trim();return!(!n||!n.length)});if(a.length&&a.length>=4){var l=a[3].trim(),m=o(a[0]),c=o(a[1]),u=o(a[2]),d=e.Elements.elementsBySymbol[l.toUpperCase()];d?r.atoms.push({kind:d,x:m,y:c,z:u,bonds:[]}):console.warn("atom not found "+l)}}return console.log("found "+r.atoms.length),r}}}(e.Parser||(e.Parser={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){n.pdb={parse:function(e){console.log("parsing pdb content");for(var n={atoms:[],title:null},o=e.split("\n"),r=0,t=o.length;r<t;r++){var s=o[r];0!=s.indexOf("HETATM")&&0!=s.indexOf("ATOM")||this.parseHETATM(n,s)}return console.log("found "+n.title+" "+n.atoms.length),n},parseHETATM:function(n,o){var r=o.substr(12,2).trim();!1===isNaN(r[0])&&(r=r.substr(1));var t=e.Elements.elementsBySymbol[r.toUpperCase()];if(t){var s=parseFloat(o.substr(30,8).trim()),i=parseFloat(o.substr(38,8).trim()),a=parseFloat(o.substr(46,8).trim());n.atoms.push({kind:t,x:s,y:i,z:a,bonds:[]})}else console.warn("atom not found "+r)}}}(e.Parser||(e.Parser={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){function o(e){return e?parseFloat(e.trim()):0}n.xyz={parse:function(n){console.log("parsing xyz content");var r={atoms:[],title:null},t=n.split("\n");r.title=t[1];for(var s=2,i=t.length;s<i;s++){var a=t[s].split(" ").filter(function(e){var n=e.trim();return!(!n||!n.length)});if(a.length&&a.length>=4){var l=a[0].trim(),m=o(a[1]),c=o(a[2]),u=o(a[3]),d=e.Elements.elementsBySymbol[l.toUpperCase()];d?r.atoms.push({kind:d,x:m,y:c,z:u,bonds:[]}):console.warn("atom not found "+l)}}return console.log("found "+r.title+" "+r.atoms.length),r}}}(e.Parser||(e.Parser={}))}(Molvwr||(Molvwr={}));var __global=this,Molvwr;!function(e){!function(e){function n(e,o,r,t,s){return s&&console.log(s+" "+e+"/"+r.length),new c(function(i,a){l(function(){var l=r.slice(e,e+o);l.forEach(function(n,o){t(n,o,o+e)}),l.length<o?i():n(e+o,o,r,t,s).then(i,a)})})}function o(e){var n=this;if(null===this._state)return void this._deferreds.push(e);l(function(){var o=n._state?e.onFulfilled:e.onRejected;if(null===o)return void(n._state?e.resolve:e.reject)(n._value);var r;try{r=o(n._value)}catch(n){return console.error(n),void e.reject(n)}e.resolve(r)})}function r(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void a(n.bind(e),r.bind(this),t.bind(this))}this._state=!0,this._value=e,s.call(this)}catch(e){console.error(e),t.call(this,e)}}function t(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,n=this._deferreds.length;e<n;e++)o.call(this,this._deferreds[e]);this._deferreds=null}function i(e,n,o,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=o,this.reject=r}function a(e,n,o){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,o(e))})}catch(e){if(console.error(e),r)return;r=!0,o(e)}}var l="function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,1)},m=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.runBatch=n;var c=function(){function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],a(e,r.bind(this),t.bind(this))}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.then=function(n,r){var t=this;return new e(function(e,s){o.call(t,new i(n,r,e,s))})},e.timeout=function(n){return new e(function(e,o){setTimeout(function(){e()},n)})},e.all=function(n){var o=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new e(function(e,n){function r(s,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var a=i.then;if("function"==typeof a)return void a.call(i,function(e){r(s,e)},n)}o[s]=i,0==--t&&e(o)}catch(e){console.error(e),n(e)}}if(0===o.length)return e([]);for(var t=o.length,s=0;s<o.length;s++)r(s,o[s])})},e.resolve=function(n){return n&&"object"==typeof n&&n.constructor===e?n:new e(function(e){e(n)})},e.reject=function(n){return new e(function(e,o){o(n)})},e.race=function(n){return new e(function(e,o){for(var r=0,t=n.length;r<t;r++)n[r].then(e,o)})},e._setImmediateFn=function(e){l=e},e}();e.Promise=c}(e.Utils||(e.Utils={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){var o=function(){function n(e,n,o){this.meshes={},this.ctx=n,this.config=o,this.viewer=e}return n.prototype.render=function(n){var o=this,r=(this.config,e.Elements.MIN_ATOM_RADIUS*this.config.cylinderScale*this.config.atomScaleFactor);n.bonds.length;return this.prepareBonds(n,r).then(function(){return console.time("cylinder rendering"),e.Utils.runBatch(0,n.batchSize,n.bonds,function(e,n){var r=e.atomA.kind.symbol+"#"+e.atomB.kind.symbol,t=o.meshes[r],s=t.createInstance("bond"+n);o.alignCylinderToBinding(e.atomA,e.atomB,e.d,s)},"cylinder rendering").then(function(){console.timeEnd("cylinder rendering")})})},n.prototype.prepareBonds=function(n,o){var r=this;console.time("prepare bonds as cylinder");var t=[];for(var s in n.bondkinds)t.push(n.bondkinds[s]);var i=100;return this.config.cylinderLOD&&(i=i/this.config.cylinderLOD.length>>0),e.Utils.runBatch(0,i,t,function(e,n){r.meshes[e.key]=r.createMesh(e,o)},"prepare cylinder").then(function(){console.timeEnd("prepare bonds as cylinder")})},n.prototype.createMesh=function(e,n){if(this.config.cylinderLOD){for(var o=this.config.cylinderLOD[0],r=this.createCylinder(e,n,0,o.segments,o.effects,o.color),t=1,s=this.config.cylinderLOD.length;t<s;t++){var i=this.config.cylinderLOD[t];if(i.segments){var a=this.createCylinder(e,n,t,i.segments,i.effects,i.color);r.addLODLevel(i.depth,a)}else r.addLODLevel(i.depth,null)}return r}return this.createCylinder(e,n,0,this.config.cylinderSegments,!0,null)},n.prototype.createCylinder=function(e,n,o,r,t,s){var i=BABYLON.Mesh.CreateCylinder("bondtemplate"+e.key,e.d,n,n,r,2,this.ctx.scene,!1),a=new BABYLON.StandardMaterial("materialFor"+e.key+o,this.ctx.scene);s||e.kindA.color;return a.diffuseColor=new BABYLON.Color3(.3,.3,.3),this.ctx.cylinderMaterial(i,a,t),i.material=a,i.isPickable=!1,i.setEnabled(!1),i},n.prototype.alignCylinderToBinding=function(e,n,o,r){var t=new BABYLON.Vector3(e.x,e.y,e.z),s=new BABYLON.Vector3(n.x,n.y,n.z),i=s.subtract(t);i.normalize();var a=new BABYLON.Vector3(0,1,0);if(this.vectorEqualsCloseEnough(i,a.negate())){console.log("must invert...");var a=new BABYLON.Vector3(1,0,0),l=BABYLON.Vector3.Cross(a,i);l.normalize();var m=BABYLON.Vector3.Dot(i,a);m=Math.acos(m)+Math.PI/2,r.setPivotMatrix(BABYLON.Matrix.Translation(0,-o/2,0)),r.position=s;var c=BABYLON.Quaternion.RotationAxis(l,m);c.w=-c.w,r.rotationQuaternion=c,console.log(r.rotationQuaternion)}else{var l=BABYLON.Vector3.Cross(a,i);l.normalize();var m=BABYLON.Vector3.Dot(i,a);m=Math.acos(m),r.setPivotMatrix(BABYLON.Matrix.Translation(0,-o/2,0)),r.position=s,r.rotationQuaternion=BABYLON.Quaternion.RotationAxis(l,m)}},n.prototype.vectorEqualsCloseEnough=function(e,n,o){if(void 0===o&&(o=2e-5),"object"!=typeof n)throw"v2 is supposed to be an object";if("object"!=typeof e)throw"v1 is supposed to be an object";return!(e.x<n.x-o||e.x>n.x+o)&&(!(e.y<n.y-o||e.y>n.y+o)&&!(e.z<n.z-o||e.z>n.z+o))},n}();n.BondsCylinder=o}(e.Renderer||(e.Renderer={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){var o=function(){function n(e,n,o){this.meshes={},this.ctx=n,this.config=o,this.viewer=e}return n.prototype.render=function(n){var o=this,r=(this.config,[]);return console.log("rendering bonds as lines"),n.bonds.forEach(function(e,n){var t=BABYLON.Mesh.CreateLines("bond-"+n,[new BABYLON.Vector3(e.atomA.x,e.atomA.y,e.atomA.z),new BABYLON.Vector3(e.atomB.x,e.atomB.y,e.atomB.z)],o.ctx.scene,!1);t.color=new BABYLON.Color3(.5,.5,.5),r.push(t)}),e.Utils.Promise.resolve()},n}();n.BondsLines=o}(e.Renderer||(e.Renderer={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){var o=function(){function n(e,n,o){this.meshes={},this.ctx=n,this.config=o,this.viewer=e}return n.prototype.render=function(n){var o=this;return this.prepareMeshes(n).then(function(){return console.time("sphere rendering"),e.Utils.runBatch(0,n.batchSize,n.atoms,o.renderAtom.bind(o),"sphere rendering").then(function(){console.timeEnd("sphere rendering")})})},n.prototype.prepareMeshes=function(n){var o=this;console.time("prepare spheres");var r=[];for(var t in n.kinds)r.push(n.kinds[t]);return e.Utils.runBatch(0,100,r,function(e,n){o.meshes[e.kind.symbol]=o.createMesh(e.kind)},"prepare spheres").then(function(){console.timeEnd("prepare spheres")})},n.prototype.createMesh=function(e){if(this.config.sphereLOD){for(var n=this.config.sphereLOD[0],o=this.createSphere(e,n.segments,n.effects,n.color),r=1,t=this.config.sphereLOD.length;r<t;r++){var s=this.config.sphereLOD[r];if(s.segments){var i=this.createSphere(e,s.segments,s.effects,s.color);o.addLODLevel(s.depth,i)}else o.addLODLevel(s.depth,null)}return o}return this.createSphere(e,this.config.sphereSegments,!0,null)},n.prototype.createSphere=function(e,n,o,r){var t=BABYLON.Mesh.CreateSphere("spheretemplate",n,e.radius*this.config.atomScaleFactor,this.ctx.scene,!1);t.setEnabled(!1),t.isPickable=!1;var s=new BABYLON.StandardMaterial("materialFor"+e.symbol,this.ctx.scene),i=r||e.color;return s.diffuseColor=new BABYLON.Color3(i[0],i[1],i[2]),this.ctx.sphereMaterial(t,s,o),t.material=s,t},n.prototype.renderAtom=function(e,n){var o=(this.config,this.meshes[e.kind.symbol]);o||console.warn("no mesh for "+e.kind.symbol);var r=o.createInstance("sphere"+n);return r.pickable=!1,r.position.x=e.x,r.position.y=e.y,r.position.z=e.z,r},n}();n.Sphere=o}(e.Renderer||(e.Renderer={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){var o=function(){function n(e,n,o){this.meshes={},this.ctx=n,this.config=o,this.viewer=e}return n.prototype.render=function(n){var o=this,r=(this.config,e.Elements.MIN_ATOM_RADIUS*this.config.cylinderScale*this.config.atomScaleFactor);n.bonds.length;return this.prepareBonds(n,r).then(function(){return console.time("sticks rendering"),e.Utils.runBatch(0,n.batchSize,n.bonds,function(e,n){var r=e.atomA.kind.symbol+"#"+e.atomB.kind.symbol,t=o.meshes[r],s=t.createInstance("bond"+n);o.alignCylinderToBinding(e.atomA,e.atomB,e.d,s)}).then(function(){console.timeEnd("sticks rendering")})})},n.prototype.prepareBonds=function(n,o){var r=this;console.time("prepare bonds as sticks");var t=[];for(var s in n.bondkinds)t.push(n.bondkinds[s]);var i=50;return this.config.cylinderLOD&&(i=i/this.config.cylinderLOD.length>>0),e.Utils.runBatch(0,i,t,function(e,n){r.meshes[e.key]=r.createMesh(e,o)},"prepare sticks").then(function(){console.timeEnd("prepare bonds as sticks")})},n.prototype.createMesh=function(e,n){var o=this.createStickMergemesh;if(this.config.cylinderLOD){for(var r=this.config.cylinderLOD[0],t=o.apply(this,[e,n,0,r.segments,r.texture,r.effects,r.color]),s=1,i=this.config.cylinderLOD.length;s<i;s++){var a=this.config.cylinderLOD[s];if(a.segments){var l=o.apply(this,[e,n,s,a.segments,a.texture,a.effects,a.color]);t.addLODLevel(a.depth,l)}else t.addLODLevel(a.depth,null)}return t}return o.apply(this,[e,n,0,this.config.cylinderSegments,!0,!0,null])},n.prototype.createStickMergemesh=function(e,n,o,r,t,s,i){var a=n/2,l=e.d-a/2.5,m=l/2,c=BABYLON.Mesh.CreateCylinder("bondtemplate"+e.key+"-"+o,l,n,n,r,2,this.ctx.scene,!1),u=(c.getIndices(),BABYLON.Mesh.CreateSphere("sphereA"+e.key+"-"+o,r,n,this.ctx.scene,!1));u.position.y=-m;var d=BABYLON.Mesh.CreateSphere("sphereB"+e.key+"-"+o,r,n,this.ctx.scene,!1);d.position.y=m;var h=BABYLON.Mesh.MergeMeshes([u,c,d],!0),f=new BABYLON.StandardMaterial("materialFor"+e.key+e.kindA.symbol+"-"+o,this.ctx.scene),p=i||e.kindA.color;f.diffuseColor=new BABYLON.Color3(p[0],p[1],p[2]),this.ctx.cylinderMaterial(null,f,s);var b=new BABYLON.StandardMaterial("materialFor"+e.key+e.kindB.symbol+"-"+o,this.ctx.scene),y=i||e.kindB.color;b.diffuseColor=new BABYLON.Color3(y[0],y[1],y[2]),this.ctx.cylinderMaterial(null,b,s);var v=new BABYLON.MultiMaterial("materialFor"+e.key+"-"+o,this.ctx.scene);v.subMaterials.push(f),v.subMaterials.push(b);var g=h.getTotalVertices(),B=h.getIndices();h.subMeshes=[];var w=(B.length/2>>0)-3*r;return h.subMeshes.push(new BABYLON.SubMesh(0,0,g,0,w,h)),h.subMeshes.push(new BABYLON.SubMesh(1,0,g,w,B.length-w,h)),h.material=v,h.isPickable=!1,h.setEnabled(!1),h},n.prototype.alignCylinderToBinding=function(e,n,o,r){var t=new BABYLON.Vector3(e.x,e.y,e.z),s=new BABYLON.Vector3(n.x,n.y,n.z),i=s.subtract(t);i.normalize();var a=new BABYLON.Vector3(0,1,0);if(this.vectorEqualsCloseEnough(i,a.negate())){var a=new BABYLON.Vector3(1,0,0),l=BABYLON.Vector3.Cross(a,i);l.normalize();var m=BABYLON.Vector3.Dot(i,a);m=Math.acos(m)+Math.PI/2,r.setPivotMatrix(BABYLON.Matrix.Translation(0,-o/2,0)),r.position=s;var c=BABYLON.Quaternion.RotationAxis(l,m);c.w=-c.w,r.rotationQuaternion=c,console.log(r.rotationQuaternion)}else{var l=BABYLON.Vector3.Cross(a,i);l.normalize();var m=BABYLON.Vector3.Dot(i,a);m=Math.acos(m),r.setPivotMatrix(BABYLON.Matrix.Translation(0,-o/2,0)),r.position=s,r.rotationQuaternion=BABYLON.Quaternion.RotationAxis(l,m)}},
n.prototype.vectorEqualsCloseEnough=function(e,n,o){if(void 0===o&&(o=2e-5),"object"!=typeof n)throw"v2 is supposed to be an object";if("object"!=typeof e)throw"v1 is supposed to be an object";return!(e.x<n.x-o||e.x>n.x+o)&&(!(e.y<n.y-o||e.y>n.y+o)&&!(e.z<n.z-o||e.z>n.z+o))},n}();n.Sticks=o}(e.Renderer||(e.Renderer={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(n){var o=function(){function n(n){this.options=n,n||(console.log("default viewmode config"),this.options=e.ViewModes.Standard.defaultConfig()),this.options.sphere||(this.options.sphere={}),this.options.cylinder||(this.options.cylinder={})}return n.defaultConfig=function(){var e={texture:!1,emisivefresnel:new BABYLON.FresnelParameters,cylinder:{},sphere:{}};return e.emisivefresnel.bias=.3,e.emisivefresnel.power=1,e.emisivefresnel.leftColor=BABYLON.Color3.Black(),e.emisivefresnel.rightColor=BABYLON.Color3.White(),e},n.prototype.getColor=function(e,n){return e&&e.length>=3?new BABYLON.Color3(e[0],e[1],e[2]):new BABYLON.Color3(n[0],n[1],n[2])},n.prototype.createScene=function(e){e.scene.clearColor=this.getColor(this.options.clearColor,[.9,.9,.95]),e.scene.fogMode=BABYLON.Scene.FOGMODE_EXP2,e.scene.fogColor=this.getColor(this.options.fogColor,[.9,.9,.85]),e.scene.fogDensity=this.options.fogDensity||.01;var n=new BABYLON.ArcRotateCamera("Camera",0,1,7,new BABYLON.Vector3(0,0,0),e.scene);n.wheelPrecision=this.options.wheelPrecision||10,n.pinchPrecision=this.options.pinchPrecision||7,n.panningSensibility=this.options.panningSensibility||70,n.setTarget(BABYLON.Vector3.Zero()),n.attachControl(e.canvas,!1),e.camera=n;var o=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),e.scene);o.intensity=.7,o.groundColor=this.getColor(this.options.groundColor,[.4,.4,.4]),o.specular=this.getColor(this.options.specular,[.5,.5,.5])},n.prototype.applyTexture=function(e,n,o){o.diffuseTexture&&(n.diffuseTexture=new BABYLON.Texture(o.diffuseTexture,e.scene),n.diffuseTexture.uScale=o.textureScale||1,n.diffuseTexture.vScale=o.textureScale||1),o.specularTexture&&(n.specularTexture=new BABYLON.Texture(o.specularTexture,e.scene),n.specularTexture.uScale=o.textureScale||1,n.specularTexture.vScale=o.textureScale||1),o.bumpTexture&&(n.bumpTexture=new BABYLON.Texture(o.bumpTexture,e.scene),n.bumpTexture.uScale=o.textureScale||1,n.bumpTexture.vScale=o.textureScale||1)},n.prototype.sphereMaterial=function(e,n,o,r){o.ambientColor=new BABYLON.Color3(0,0,1),o.specularColor=new BABYLON.Color3(.1,.1,.1),o.emissiveColor=new BABYLON.Color3(.2,.2,.2),r&&(this.options.emisivefresnel&&(o.emissiveFresnelParameters=this.options.emisivefresnel),this.options.sphere&&this.applyTexture(e,o,this.options.sphere))},n.prototype.cylinderMaterial=function(e,n,o,r){o.ambientColor=new BABYLON.Color3(0,0,1),o.specularColor=new BABYLON.Color3(.2,.2,.2),o.emissiveColor=new BABYLON.Color3(.2,.2,.2),r&&(this.options.emisivefresnel&&(o.emissiveFresnelParameters=this.options.emisivefresnel),this.options.cylinder&&this.applyTexture(e,o,this.options.cylinder))},n}();n.Standard=o}(e.ViewModes||(e.ViewModes={}))}(Molvwr||(Molvwr={}));var Molvwr;!function(e){!function(e){var n=function(){function e(){}return e.prototype.createScene=function(e){e.scene.clearColor=new BABYLON.Color3(.9,.9,.95),e.scene.fogMode=BABYLON.Scene.FOGMODE_EXP2,e.scene.fogColor=new BABYLON.Color3(.9,.9,.85),e.scene.fogDensity=.01;var n=new BABYLON.ArcRotateCamera("Camera",1,.8,28,new BABYLON.Vector3(0,0,0),e.scene);n.wheelPrecision=10,n.pinchPrecision=7,n.panningSensibility=70,n.setTarget(BABYLON.Vector3.Zero()),n.attachControl(e.canvas,!1),e.camera=n;var o=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),e.scene);o.intensity=.7,o.groundColor=new BABYLON.Color3(.4,.4,.4),o.specular=new BABYLON.Color3(.5,.5,.5)},e.prototype.sphereMaterial=function(e,n,o,r){},e.prototype.cylinderMaterial=function(e,n,o,r){},e.prototype.useAmbientOcclusion=function(e){new BABYLON.SSAORenderingPipeline("ssaopipeline",e.scene,.75);e.scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline("ssaopipeline",e.camera)},e.prototype.useHDR=function(e){var n=new BABYLON.HDRRenderingPipeline("hdr",e.scene,1,null,[e.camera]);n.brightThreshold=1.2,n.gaussCoeff=.3,n.gaussMean=1,n.gaussStandDev=.8,n.exposure=1,n.minimumLuminance=.5,n.maximumLuminance=1e10,n.luminanceDecreaseRate=.5,n.luminanceIncreaserate=.5,e.scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline("hdr",[e.camera])},e.prototype.useLensEffect=function(e){new BABYLON.LensRenderingPipeline("lens",{edge_blur:.2,chromatic_aberration:.2,distortion:.2,dof_focus_depth:100/e.camera.maxZ,dof_aperture:1,grain_amount:.2,dof_pentagon:!0,dof_gain:1,dof_threshold:1},e.scene,1,[e.camera])},e}();e.Experiments=n}(e.ViewModes||(e.ViewModes={}))}(Molvwr||(Molvwr={}));
